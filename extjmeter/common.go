package extjmeter

import (
	"github.com/rs/zerolog/log"
	"github.com/steadybit/action-kit/go/action_kit_api/v2"
	"github.com/steadybit/extension-kit/extutil"
	"strings"
)

const (
	targetType = "com.steadybit.extension_jmeter.location"
	targetIcon = "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik00LjUgOS4xQzQuNSA0LjkyIDcuODc1IDEuNSAxMiAxLjVDMTYuMTI1IDEuNSAxOS41IDQuOTIgMTkuNSA5LjFDMTkuNSAxMy45MTM1IDEzLjcyMjQgMTkuMzEyNCAxMi43NzcgMjAuMTk1OEMxMi43MTQ5IDIwLjI1MzkgMTIuNjczNiAyMC4yOTI0IDEyLjY1NjIgMjAuMzFDMTIuNDY4OCAyMC40MDUgMTIuMTg3NSAyMC41IDEyIDIwLjVDMTEuODEyNSAyMC41IDExLjUzMTIgMjAuNDA1IDExLjM0MzggMjAuMzFDMTEuMzI2NCAyMC4yOTI0IDExLjI4NTEgMjAuMjUzOSAxMS4yMjMgMjAuMTk1OEMxMC4yNzc2IDE5LjMxMjQgNC41IDEzLjkxMzUgNC41IDkuMVpNNi4zNzUgOS4xQzYuMzc1IDEyLjMzIDEwLjAzMTIgMTYuNDE1IDEyIDE4LjMxNUMxMy45Njg4IDE2LjQxNSAxNy42MjUgMTIuMjM1IDE3LjYyNSA5LjFDMTcuNjI1IDUuOTY1IDE1LjA5MzggMy40IDEyIDMuNEM4LjkwNjI1IDMuNCA2LjM3NSA1Ljk2NSA2LjM3NSA5LjFaTTguMjUgOS4xQzguMjUgNy4wMSA5LjkzNzUgNS4zIDEyIDUuM0MxNC4wNjI1IDUuMyAxNS43NSA3LjAxIDE1Ljc1IDkuMUMxNS43NSAxMS4xOSAxNC4wNjI1IDEyLjkgMTIgMTIuOUM5LjkzNzUgMTIuOSA4LjI1IDExLjE5IDguMjUgOS4xWk0xMC4xMjUgOS4xQzEwLjEyNSAxMC4xNDUgMTAuOTY4OCAxMSAxMiAxMUMxMy4wMzEyIDExIDEzLjg3NSAxMC4xNDUgMTMuODc1IDkuMUMxMy44NzUgOC4wNTUgMTMuMDMxMiA3LjIgMTIgNy4yQzEwLjk2ODggNy4yIDEwLjEyNSA4LjA1NSAxMC4xMjUgOS4xWk01LjA3MzMyIDE2Ljg3NDVDNS41NTYyNyAxNi42MDY2IDUuNzMwNjEgMTUuOTk3OSA1LjQ2MjcgMTUuNTE0OUM1LjE5NDggMTUuMDMyIDQuNTg2MSAxNC44NTc2IDQuMTAzMTUgMTUuMTI1NUMyLjc0Mzg0IDE1Ljg3OTYgMiAxNi45NTE1IDIgMTguMjVDMiAxOS4xMTYxIDIuNDI1NTEgMTkuODUwNyAzLjAwNTQ4IDIwLjQyMjFDMy41ODE5MyAyMC45ODk5IDQuMzY0NzYgMjEuNDU1MyA1LjI1MTQyIDIxLjgyNDdDNy4wMjkxMyAyMi41NjU0IDkuNDE1NjkgMjMgMTIgMjNDMTQuNTg0MyAyMyAxNi45NzA5IDIyLjU2NTQgMTguNzQ4NiAyMS44MjQ3QzE5LjYzNTIgMjEuNDU1MyAyMC40MTgxIDIwLjk4OTkgMjAuOTk0NSAyMC40MjIxQzIxLjU3NDUgMTkuODUwNyAyMiAxOS4xMTYxIDIyIDE4LjI1QzIyIDE2Ljk1MTUgMjEuMjU2MiAxNS44Nzk2IDE5Ljg5NjkgMTUuMTI1NUMxOS40MTM5IDE0Ljg1NzYgMTguODA1MiAxNS4wMzIgMTguNTM3MyAxNS41MTQ5QzE4LjI2OTQgMTUuOTk3OSAxOC40NDM3IDE2LjYwNjYgMTguOTI2NyAxNi44NzQ1QzE5LjgyNzEgMTcuMzczOSAyMCAxNy44NjAxIDIwIDE4LjI1QzIwIDE4LjQxOTQgMTkuOTIxOCAxOC42NzEzIDE5LjU5MSAxOC45OTczQzE5LjI1NjUgMTkuMzI2NyAxOC43MjE0IDE5LjY2OTQgMTcuOTc5MyAxOS45Nzg2QzE2LjQ5OTcgMjAuNTk1MSAxNC4zODYzIDIxIDEyIDIxQzkuNjEzNzUgMjEgNy41MDAzMSAyMC41OTUxIDYuMDIwNjUgMTkuOTc4NkM1LjI3ODY0IDE5LjY2OTQgNC43NDM0NSAxOS4zMjY3IDQuNDA5MDUgMTguOTk3M0M0LjA3ODE3IDE4LjY3MTMgNCAxOC40MTk0IDQgMTguMjVDNCAxNy44NjAxIDQuMTcyOTUgMTcuMzczOSA1LjA3MzMyIDE2Ljg3NDVaIiBmaWxsPSIjMUQyNjMyIi8+Cjwvc3ZnPgo="

	actionId   = "com.steadybit.extension_jmeter.run"
	actionIcon = "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjUiIHZpZXdCb3g9IjAgMCAyNCAyNSIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBkPSJNMjAuNzU1IDMuNzQ1Yy0uMTY0LS4xNjMtLjQxLS4yNDUtLjczNy0uMjQ1LS4zMjcuMDgyLTkuMDgyIDEuNTU1LTEyLjY4MiA1LjE1NS0yLjUzNiAyLjUzNi0yLjcgNS4zMTgtMi4yOSA3LjI4MWwzLjAyNy0xLjhjLjQwOS0uMjQ1LjgxOC4zMjguNDkuNjU1bC0zLjAyNyAzLjAyNy0yLjI5IDIuMjkxYS43OS43OSAwIDAwMCAxLjE0NS43NDMuNzQzIDAgMDAuNTcyLjI0NmMuMjQ2IDAgLjQxLS4wODIuNTczLS4yNDVsMi4yOS0yLjI5MWMuNjU1LjMyNyAxLjg4My43MzYgMy40MzcuNzM2IDEuOCAwIDMuNDM3LS41NzMgNC45MS0xLjcxOC4yNDUtLjE2NC40MDgtLjU3My4yNDUtLjlsLTEuMTQ2LTQuMDkxIDIuOTQ2IDEuMTQ1Yy40MDkuMTY0LjkgMCAxLjA2My0uNDA5LjQyNC0uOTQ3LjgwNy0xLjk3NCAxLjE0Ni0yLjk4NkMxOS40NDMgMTAuMjYgMTcuNSA4LjUgMTcuNSA4LjVzMi41LS4wOCAyLjYxNy0uNWMuNTMtMS45MDcuODQtMy4zNTEuODgzLTMuNDM2IDAtLjMyOC0uMDgyLS42NTUtLjI0NS0uODE5eiIgZmlsbD0iY3VycmVudENvbG9yIi8+PC9zdmc+"
)

func stdOutToLog(lines []string) {
	for _, line := range lines {
		trimmed := strings.TrimSpace(strings.ReplaceAll(line, "\n", ""))
		if len(trimmed) > 0 {
			log.Info().Msgf("---- %s", trimmed)
		}
	}
}

func stdOutToMessages(lines []string) []action_kit_api.Message {
	messages := make([]action_kit_api.Message, 0)
	for _, line := range lines {
		trimmed := strings.TrimSpace(strings.ReplaceAll(line, "\n", ""))
		if len(trimmed) > 0 {
			messages = append(messages, action_kit_api.Message{
				Level:   extutil.Ptr(action_kit_api.Info),
				Message: trimmed,
			})
		}
	}
	return messages
}
